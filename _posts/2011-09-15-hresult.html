---
layout: post
title: HRESULT
date: '2011-09-15T10:00:00.000-07:00'
author: Kirk
tags:
- win32
- error handling
- programming
modified_time: '2011-09-20T09:44:27.929-07:00'
blogger_id: tag:blogger.com,1999:blog-7018293688983612487.post-2029892294942885397
blogger_orig_url: http://kirkshoop.blogspot.com/2011/09/hresult.html
---

<p><code>HRESULT</code> is the highest fidelity error code of the three big ones (<code><a href="{{ site.baseurl }}{% post_url 2011-09-13-winerror %}">WINERROR</a></code>, <code>NTSTATUS</code> and <code>HRESULT</code>). Both of the other error types can be converted, without any information loss, into an <code>HRESULT</code> via <code>HRESULT_FROM_WIN32</code> and <code>HRESULT_FROM_NT</code>. </p><p><code>HRESULT</code> was defined as the error type for COM functions to return. </p><p><code>HRESULT</code> and <code>NTSTATUS</code> have a similar structure but very different sets of values.<br />1bit holds 2 severity levels, SUCCESS, ERROR.<br />1bit is used to allow HRESULT_FROM_NT to store a full NTSTATUS in an HRESULT. The define for this bit is FACILITY_NT_BIT.<br />There are 12bits set aside for Facilities, which are used to create feature-specific error codes. Within each facility is 16bits to define codes specific to that facility.<br /><code>FACILITY_NULL</code> contains generic codes like <code>S_OK</code>, <code>E_FAIL</code> and <code>S_FALSE</code>.<br /><code>FACILITY_WIN32</code> contains all the WINERROR codes.<br /></p><p>Checking <code>HRESULT</code> values must be done via the SUCCEEDED(hr) or FAILED(hr) macros. </p><p><h3><code>HRESULT</code> Usage</h3><pre class="prettyprint lang-cpp"><br />HRESULT ApiReturningHresult(HANDLE handle)<br />{<br />  if (handle == INVALID_HANDLE_VALUE) {<br />    return E_HANDLE;<br />  }<br />  return S_OK;<br />}<br /><br />HRESULT hr = S_OK;<br />HANDLE handle = INVALID_HANDLE_VALUE;<br />hr = ApiReturningHresult(handle);<br />if (FAILED(hr))<br />{<br />  printf("ApiReturningHresult returned %x", hr);<br />  exit();<br />}<br /></pre></p><p><h3>Conversions to <code>HRESULT</code></h3><pre class="prettyprint lang-cpp"><br />NTSTATUS ntstatus = STATUS_SUCCESS;<br />HRESULT hr = HRESULT_FROM_NT(ntstatus);<br /><br />DWORD winerror = ERROR_SUCCESS;<br />HRESULT hr = HRESULT_FROM_WIN32(winerror);<br /></pre></p><p><h3>Conversions from <code>HRESULT</code></h3><pre class="prettyprint lang-cpp"><br />HRESULT = S_OK;<br />NTSTATUS ntstatus = STATUS_SUCCESS;<br />if (hr &amp; FACILITY_NT_BIT)<br />{<br />  ntstatus = hr &amp; ~FACILITY_NT_BIT;<br />} else if (HRESULT_FACILITY(hr) == FACILITY_WIN32)<br />{<br />  ntstatus = NTSTATUS_FROM_WIN32(HRESULT_CODE(hr));<br />} else if (SUCCEEDED(hr))<br />{<br />  ntstatus = STATUS_SUCCESS;<br />} else<br />{<br />  ntstatus = STATUS_UNSUCCESSFUL;<br />}<br /><br />HRESULT hr = S_OK;<br />DWORD winerror = ERROR_SUCCESS;<br />if (SUCCEEDED(hr))<br />{<br />  winerror = S_OK;<br />} else if (HRESULT_FACILITY(hr) == FACILITY_WIN32)<br />{<br />  winerror = HRESULT_CODE(hr);<br />} else<br />{<br />  winerror = ERROR_UNIDENTIFIED_ERROR;<br />}<br /></pre></p>