---
layout: post
title: I loathe bool function parameters
date: '2011-09-22T10:00:00.000-07:00'
author: Kirk
tags:
- programming
modified_time: '2011-09-22T10:00:01.662-07:00'
blogger_id: tag:blogger.com,1999:blog-7018293688983612487.post-7444797505794104133
blogger_orig_url: http://kirkshoop.blogspot.com/2011/09/i-loathe-bool-function-parameters.html
---

<p>What does <code class="prettyprint lang-cpp">HANDLE event = CreateEvent(NULL, TRUE, FALSE, NULL);</code> do?<br />In this case <code class="prettyprint lang-cpp">bManualReset = TRUE</code> and <code class="prettyprint lang-cpp">bInitialState = FALSE</code>. </p><p>By combining patterns that I observed in the code of various co-workers and adding some of my own, I built the following pattern for making enums that can be used for parameters with any number of states, including bool. </p><pre class="prettyprint lang-cpp"><br />namespace Win32<br />{<br />namespace Event<br />{<br />namespace Reset<br />{<br />enum type {<br />  // ensures that zero<br />  // initialized is invalid<br />  Invalid = 0,<br /><br />  Manual,<br />  Auto,<br /><br />  End,<br />  Begin = Manual<br />};<br /><br />inline BOOL make(type from)<br />{<br />  switch (from) {<br />  case Manual:<br />    return TRUE;<br />  case Auto:<br />    return FALSE;<br />  default:<br />    terminate();<br />  };<br />}<br />}<br /><br />namespace Value<br />{<br />enum type {<br />  // ensures that zero<br />  // initialized is invalid<br />  Invalid = 0,<br /><br />  Set,<br />  Reset,<br /><br />  End,<br />  Begin = Set<br />};<br /><br />inline BOOL make(type from)<br />{<br />  switch (from) {<br />  case Set:<br />    return TRUE;<br />  case Reset:<br />    return FALSE;<br />  default:<br />    terminate();<br />  };<br />}<br />}<br />}<br />}<br /><br />// now you can write this<br />// (the make functions are found via ADL)<br />namespace we = Win32::Event;<br />HANDLE event = nullptr;<br />event = CreateEvent(<br />    nullptr,<br />    make(we::Reset::Manual),<br />    make(we::Value::Reset),<br />    nullptr<br />    );<br /></pre><p>A remaining issue is that the compiler cannot enforce the type safety on the result of the make functions, so reversing the <code>bManualReset</code> and <code>bInitialState</code> parameters will compile without error and lie to readers of the code. </p><p>This issue does not plague functions that are defined to use the enum types. So, with a little more work: </p><pre class="prettyprint lang-cpp"><br />namespace Win32<br />{<br />namespace Event<br />{<br />inline HANDLE Create(<br />  Reset::type reset,<br />  Value::type value,<br />  LPCWSTR name = nullptr<br />)<br />{<br />  return CreateEventW(<br />      nullptr,<br />      make(reset),<br />      make(value),<br />      name);<br />}<br /><br />inline HANDLE Create(<br />  LPSECURITY_ATTRIBUTES security,<br />  Reset::type reset,<br />  Value::type value,<br />  LPCWSTR name = nullptr<br />)<br />{<br />  return CreateEventW(<br />      security,<br />      make(reset),<br />      make(value),<br />      name);<br />}<br />}<br />}<br /><br />// now you can write this<br />namespace we = Win32::Event;<br />HANDLE event = nullptr;<br />event = we::Create(<br />    we::Reset::Manual,<br />    we::Value::Reset<br />    );<br /></pre><p>I general I try to avoid recreating named values and wrapping Api functions. Both the set of values and the valid inputs to the Api can change over time which requires me to chase the current definitions. Also, these change the surface of the Api, which creates an additional learning curve for callers. In this case where the api takes two BOOL parameters, I think the enums are valuable, but I am still somewhat ambivalent about the inline functions. </p>