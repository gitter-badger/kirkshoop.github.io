---
layout: post
title: WINDOW_MESSAGE_DEFINITION
date: '2011-12-15T10:00:00.000-08:00'
author: Kirk
tags:
- win32
- programming
modified_time: '2011-12-15T10:00:00.514-08:00'
blogger_id: tag:blogger.com,1999:blog-7018293688983612487.post-6040859810559619193
blogger_orig_url: http://kirkshoop.blogspot.com/2011/12/windowmessagedefinition.html
---

<p>WINDOW_MESSAGE_DEFINITION is used with #include to stamp out code for each window message. One example is when generator is defined. </p><pre class="prettyprint lang-cpp"><br />template&lt;typename WindowClassTag, typename Target&gt;<br />struct generator {<br />  typedef<br />    typename generator_root &lt; WindowClassTag, Target<br />#   define WINDOW_MESSAGE_DEFINE_BEGIN_GENERATOR<br />#   include "win32_messages.h"<br />#   undef WINDOW_MESSAGE_DEFINE_BEGIN_GENERATOR<br /><br />#   define WINDOW_MESSAGE_DEFINE_END_GENERATOR<br />#   include "win32_messages.h"<br />#   undef WINDOW_MESSAGE_DEFINE_END_GENERATOR<br />    &gt;::type<br />  type;<br />};<br /></pre><p>win32_messages.h contains a #define and #include for each supported window message. </p><pre class="prettyprint lang-cpp"><br />#define WINDOW_MESSAGE_DEFINITION (PAINT,   Paint,   0, ())<br />#include "win32_message_define.h"<br /><br />#define WINDOW_MESSAGE_DEFINITION (NCPAINT, NCPaint, 1, (HRGN))<br />#include "win32_message_define.h"<br /></pre><p>win32_message_define.h then uses that #define to stamp out code for that message. Here are the salient parts of win32_message_define for the generator definition. </p><pre class="prettyprint lang-cpp"><br />#define WINDOW_MESSAGE_CAPITAL_NAME           TPLT_CALL(TPLT_EXTRACT, TPLT_ARGUMENTS_APPEND_LIST(4, WINDOW_MESSAGE_DEFINITION, 0))<br />#define WINDOW_MESSAGE_CASED_NAME             TPLT_CALL(TPLT_EXTRACT, TPLT_ARGUMENTS_APPEND_LIST(4, WINDOW_MESSAGE_DEFINITION, 1))<br />#define WINDOW_MESSAGE_PARAMETER_COUNT        TPLT_CALL(TPLT_EXTRACT, TPLT_ARGUMENTS_APPEND_LIST(4, WINDOW_MESSAGE_DEFINITION, 2))<br />#define WINDOW_MESSAGE_PARAMETER_LIST         TPLT_CALL(TPLT_EXTRACT, TPLT_ARGUMENTS_APPEND_LIST(4, WINDOW_MESSAGE_DEFINITION, 3))<br /><br />#if defined(WINDOW_MESSAGE_DEFINE_BEGIN_GENERATOR)<br /><br />#define WINDOW_MESSAGE_OPTIONAL TPLT_CALL(MAKE_IDENTIFIER_EXPLICIT, (optional, WINDOW_MESSAGE_CASED_NAME))<br /><br />  , generator&lt;WindowClassTag, Target, decltype(WINDOW_MESSAGE_OPTIONAL(instance_of&lt;Target&gt;::value, instance_of&lt;Context&lt;WindowClassTag&gt;*&gt;::value, 0)) <br /><br />#undef WINDOW_MESSAGE_OPTIONAL <br /><br />#elif defined(WINDOW_MESSAGE_DEFINE_END_GENERATOR)<br />  &gt;<br />#endif<br /><br />#undef WINDOW_MESSAGE_PARAMETER_LIST<br />#undef WINDOW_MESSAGE_PARAMETER_COUNT<br />#undef WINDOW_MESSAGE_CASED_NAME<br />#undef WINDOW_MESSAGE_CAPITAL_NAME<br />#undef WINDOW_MESSAGE_DEFINITION<br /></pre><p>First the arguments are pulled out of the WINDOW_MESSAGE_DEFINITION. Then one of the #if blocks is selected and the parameters are used to fill in the name of a message specific identifier. Now that the macro machinery is exposed, here is the generator definition that is stamped out. </p><pre class="prettyprint lang-cpp"><br />template&lt;typename WindowClassTag, typename Target&gt;<br />struct generator {<br />  typedef<br />    typename generator_root &lt; <br />      WindowClassTag, <br />      Target<br />      , generator&lt;<br />          WindowClassTag, <br />          Target, <br />          decltype(<br />            optionalPaint(<br />              instance_of&lt;Target&gt;::value,<br />              instance_of&lt;Context&lt;WindowClassTag&gt;*&gt;::value, <br />              0)) <br /><br />          , generator&lt;<br />              WindowClassTag, <br />              Target, <br />              decltype(<br />                optionalNCPaint(<br />                  instance_of&lt;Target&gt;::value,<br />                  instance_of&lt;Context&lt;WindowClassTag&gt;*&gt;::value, <br />                  0)) <br />         &gt;<br />       &gt;<br />    &gt;::type<br />  type;<br />};<br /></pre><p>The 'optional' methods are also generated via the same macros. The only piece missing is another #if block in win32_message_define.h That will be next up.. </p>